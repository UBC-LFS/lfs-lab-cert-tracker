{% extends "lfs_lab_cert_tracker/base.html" %}

{% block content %}

{% if request.user.is_superuser %}
	{% include 'app/subpages/_admin_menu.html' %}
{% endif %}

{% include 'app/subpages/_return_message.html' with data=messages %}

<style>
	.tableSort {
		position: absolute;
		text-decoration: none;
		color: black;
		font-weight: bold;
		margin-left: 5px;
		padding: 0 6px;
		background: lightgray;
		transition: 0.1s;
	}
	.tableSort:nth-child(odd) {
		margin-top: -0.8em;
	}
	.tableSort:nth-child(even) {
		margin-top: 0.8em;
	}
	.tableSort:hover {
		text-decoration: none;
		color: white;
		background: #6c757d;
	}
</style>

<div id="user-areas-message"></div>

<h3 class="my-5">
	API Updates
	<small class="text-secondary">(Total: {{ total_users }})</small>
</h3>

<div class="search-field mb-2">
	<form method="GET">
		<div class="input-field">
			<input class="search-field-text" type="text" name="q" value="{{ request.GET.q }}" placeholder="Search by CWL, Name, or Certificate">
			<button class="btn btn-secondary btn-sm" type="submit">Search</button>
			<a class="btn btn-sm btn-light" href="{% url 'app:api_updates' %}">Clear</a>
		</div>
	</form>
</div>

<table class="table table-bordered table-striped table-hover table-responsive-md text-center font-size-sm table-vertical-middle">
  <thead>
    <tr>
        <th>ID</th>
		<!-- <th>CWL</th> -->
		<th>User</th>
		<!-- <th>Full Name</th> -->
        <th>Upload Date 
			<a class="tableSort" href="?sort=uploadDateAscending{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.page %}&page={{ request.GET.page }}{% endif %}">&#11165;</a>
			<a class="tableSort" href="?sort=uploadDateDescending{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.page %}&page={{ request.GET.page }}{% endif %}">&#11167;</a>
		</th>
        <th>Completion Date
			<a class="tableSort" href="?sort=completionDataAscending{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.page %}&page={{ request.GET.page }}{% endif %}">&#11165;</a>
			<a class="tableSort" href="?sort=completionDataDescending{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.page %}&page={{ request.GET.page }}{% endif %}">&#11167;</a>
		</th>
        <th>Expiry Date
			<a class="tableSort" href="?sort=expiryDateAscending{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.page %}&page={{ request.GET.page }}{% endif %}">&#11165;</a>
			<a class="tableSort" href="?sort=expiryDateDescending{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.page %}&page={{ request.GET.page }}{% endif %}">&#11167;</a>
		</th>
        <th>Certificate</th>
        <!-- <th>User ID</th> -->
        <!-- <th>By API</th> -->
    </tr>
  </thead>
  <tbody id="tableRows">
    {% for user in users %}
      <tr>
		<td>{{user.id}}</td>
		<td><a href="/app/users/{{user.user_id}}/">{{user.user_id}}, {{user.full_name}}<br />({{user.user}})</a></td>
		<!-- <td>{{user.full_name}}</td> -->
		<td>{{user.uploaded_date}}</td>
		<td>{{user.completion_date}}</td>
		<td>{{user.expiry_date}}</td>
		<!-- <td><a href="">{{user.cert_id}}</a></td> -->
		<td><a href="/app/users/{{user.user_id}}/training-record/{{user.cert_id}}/?p=account">
			{% if user.certStr|length > 40 %}
				{{user.certStr|truncatechars:40}}
			{% else %}
				{{user.certStr}}
			{% endif %}
		</a></td>
		<!-- <td>users/{{user.user_id}}/training-record/{{user.cert_id}}/</td> -->

		<!-- <td>{{user.user_id}}</td> -->
		<!-- <td>{{user.by_api}}</td> -->
      </tr>

		{% empty %}

			<tr>
				<td colspan="10">No users found</td>
			</tr>

    {% endfor %}
  </tbody>
</table>

{% include 'app/subpages/_pagination.html' with data=users %}

{% endblock %}